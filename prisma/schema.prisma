generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Company {
  id             String     @id @default(cuid())
  name           String     @unique
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  cashBalanceSRD Float      @default(0)
  cashBalanceUSD Float      @default(0)
  stockValueSRD  Float      @default(0)
  stockValueUSD  Float      @default(0)
  expenses       Expense[]
  items          Item[]
  locations      Location[]
  users          User[]

  @@map("companies")
}

model User {
  id           String       @id @default(cuid())
  name         String
  email        String       @unique
  role         UserRole     @default(STAFF)
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  companyId    String?
  password     String
  expenses     Expense[]
  items        Item[]       @relation("ItemToUser")
  locations    Location[]
  stockBatches StockBatch[] @relation("BatchToUser")
  company      Company?     @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("users")
}

model Location {
  id           String       @id @default(cuid())
  name         String
  address      String?
  description  String?
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  companyId    String
  managerId    String?
  items        Item[]       @relation("ItemToLocation")
  company      Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  manager      User?        @relation(fields: [managerId], references: [id])
  stockBatches StockBatch[] @relation("BatchToLocation")

  @@map("locations")
}

model Expense {
  id          String          @id @default(cuid())
  description String
  amount      Float
  currency    Currency        @default(SRD)
  category    ExpenseCategory @default(MISCELLANEOUS)
  date        DateTime        @default(now())
  notes       String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  companyId   String
  createdById String?
  company     Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy   User?           @relation(fields: [createdById], references: [id])

  @@map("expenses")
}

model Item {
  id                  String       @id @default(cuid())
  name                String
  status              Status?      @default(ToOrder)
  quantityInStock     Int?         @default(0)
  costPerUnitUSD      Float
  freightCostUSD      Float?       @default(0)
  sellingPriceSRD     Float
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  companyId           String
  assignedUserId      String?
  locationId          String?
  notes               String?
  expectedArrival     DateTime?
  minStockLevel       Int?
  orderDate           DateTime?
  orderNumber         String?
  profitMarginPercent Float?
  supplier            String?
  supplierSku         String?
  useBatchSystem      Boolean      @default(true)
  imageUrls           String[]     @default([])
  assignedUser        User?        @relation("ItemToUser", fields: [assignedUserId], references: [id])
  company             Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  location            Location?    @relation("ItemToLocation", fields: [locationId], references: [id])
  batches             StockBatch[] @relation("ItemBatches")

  @@map("items")
}

model StockBatch {
  id               String    @id @default(cuid())
  quantity         Int       @default(0)
  originalQuantity Int       @default(0)
  status           Status    @default(ToOrder)
  costPerUnitUSD   Float
  freightCostUSD   Float     @default(0)
  orderDate        DateTime?
  expectedArrival  DateTime?
  orderNumber      String?
  arrivedDate      DateTime?
  notes            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  itemId           String
  locationId       String?
  assignedUserId   String?
  imageUrls        String[]  @default([])
  assignedUser     User?     @relation("BatchToUser", fields: [assignedUserId], references: [id])
  item             Item      @relation("ItemBatches", fields: [itemId], references: [id], onDelete: Cascade)
  location         Location? @relation("BatchToLocation", fields: [locationId], references: [id])

  @@map("stock_batches")
}

enum UserRole {
  ADMIN
  MANAGER
  STAFF
}

enum Status {
  ToOrder
  Ordered
  Arrived
  Sold
}

enum ExpenseCategory {
  DINNER
  OFFICE_SUPPLIES
  MARKETING
  TRANSPORTATION
  UTILITIES
  RENT
  MAINTENANCE
  MISCELLANEOUS
  INCOME
}

enum Currency {
  SRD
  USD
}
