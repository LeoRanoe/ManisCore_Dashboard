"use strict";(()=>{var e={};e.id=757,e.ids=[757],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9142:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>S});var a={};r.r(a),r.d(a,{GET:()=>d});var i=r(1874),n=r(9195),s=r(8276),o=r(306),u=r(8828);async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("companyId"),a=t.get("userId"),i={};r&&"all"!==r&&(i.companyId=r),a&&"all"!==a&&(i.assignedUserId=a);let n=await u._.item.findMany({where:i,include:{company:{select:{id:!0,name:!0}},assignedUser:{select:{id:!0,name:!0,email:!0}},location:{select:{id:!0,name:!0}}}}),s=n.reduce((e,t)=>e+(t.costPerUnitUSD+t.freightCostUSD/Math.max(t.quantityInStock,1))*t.quantityInStock,0),d=n.reduce((e,t)=>e+t.sellingPriceSRD*t.quantityInStock,0),c=n.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),l={ToOrder:c.ToOrder||0,Ordered:c.Ordered||0,Arrived:c.Arrived||0,Sold:c.Sold||0},m={};if(!r||"all"===r){let e=n.reduce((e,t)=>{let r=t.company.id;return e[r]||(e[r]={name:t.company.name,items:[]}),e[r].items.push(t),e},{});Object.entries(e).forEach(([e,t])=>{let r=t.items.reduce((e,t)=>e+(t.costPerUnitUSD+t.freightCostUSD/Math.max(t.quantityInStock,1))*t.quantityInStock,0),a=t.items.reduce((e,t)=>e+t.sellingPriceSRD*t.quantityInStock,0);m[e]={name:t.name,itemCount:t.items.length,stockValueUSD:Number(r.toFixed(2)),potentialRevenueSRD:Number(a.toFixed(2))}})}let p={};if(!a||"all"===a){let e=n.reduce((e,t)=>{if(t.assignedUser){let r=t.assignedUser.id;e[r]||(e[r]={name:t.assignedUser.name,items:[]}),e[r].items.push(t)}return e},{});Object.entries(e).forEach(([e,t])=>{let r=t.items.reduce((e,t)=>e+(t.costPerUnitUSD+t.freightCostUSD/Math.max(t.quantityInStock,1))*t.quantityInStock,0);p[e]={name:t.name,itemCount:t.items.length,stockValueUSD:Number(r.toFixed(2))}})}let h=n.filter(e=>e.quantityInStock<5).slice(0,10);return o.Z.json({totalStockValueUSD:Number(s.toFixed(2)),totalPotentialRevenueSRD:Number(d.toFixed(2)),totalPotentialProfitSRD:Number((d-3.75*s).toFixed(2)),itemCountByStatus:l,companyMetrics:m,userMetrics:p,lowStockItems:h.map(e=>({id:e.id,name:e.name,quantityInStock:e.quantityInStock,status:e.status,company:e.company,assignedUser:e.assignedUser,location:e.location})),totalItems:n.length})}catch(e){return console.error("Error fetching dashboard metrics:",e),o.Z.json({error:"Internal server error"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/dashboard-metrics/route",pathname:"/api/dashboard-metrics",filename:"route",bundlePath:"app/api/dashboard-metrics/route"},resolvedPagePath:"D:\\ManisCore_Dashboard\\src\\app\\api\\dashboard-metrics\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:p,headerHooks:h,staticGenerationBailout:S}=c,g="/api/dashboard-metrics/route";function y(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}},8828:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),i=globalThis,n=i.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[147,204],()=>r(9142));module.exports=a})();