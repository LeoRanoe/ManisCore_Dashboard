"use strict";(()=>{var e={};e.id=757,e.ids=[757],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9142:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>S,originalPathname:()=>g,patchFetch:()=>U,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>y});var r={};a.r(r),a.d(r,{GET:()=>u,dynamic:()=>d});var i=a(1874),n=a(9195),s=a(8276),o=a(306),c=a(8828);let d="force-dynamic";async function u(e){try{let t=e.nextUrl.searchParams,a=t.get("companyId"),r=t.get("userId"),i={};a&&"all"!==a&&(i.companyId=a),r&&"all"!==r&&(i.assignedUserId=r);let n=await c._.item.findMany({where:i,include:{company:{select:{id:!0,name:!0}},assignedUser:{select:{id:!0,name:!0,email:!0}},location:{select:{id:!0,name:!0}}}}),s=n.reduce((e,t)=>e+(t.costPerUnitUSD+t.freightCostUSD/Math.max(t.quantityInStock,1))*t.quantityInStock,0),d=n.reduce((e,t)=>e+t.sellingPriceSRD*t.quantityInStock,0),u=n.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),l={ToOrder:u.ToOrder||0,Ordered:u.Ordered||0,Arrived:u.Arrived||0,Sold:u.Sold||0},m={};if(!a||"all"===a){let e=n.reduce((e,t)=>{let a=t.company.id;return e[a]||(e[a]={name:t.company.name,items:[]}),e[a].items.push(t),e},{});Object.entries(e).forEach(([e,t])=>{let a=t.items.reduce((e,t)=>e+(t.costPerUnitUSD+t.freightCostUSD/Math.max(t.quantityInStock,1))*t.quantityInStock,0),r=t.items.reduce((e,t)=>e+t.sellingPriceSRD*t.quantityInStock,0);m[e]={name:t.name,itemCount:t.items.length,stockValueUSD:Number(a.toFixed(2)),potentialRevenueSRD:Number(r.toFixed(2))}})}let p={};if(!r||"all"===r){let e=n.reduce((e,t)=>{if(t.assignedUser){let a=t.assignedUser.id;e[a]||(e[a]={name:t.assignedUser.name,items:[]}),e[a].items.push(t)}return e},{});Object.entries(e).forEach(([e,t])=>{let a=t.items.reduce((e,t)=>e+(t.costPerUnitUSD+t.freightCostUSD/Math.max(t.quantityInStock,1))*t.quantityInStock,0);p[e]={name:t.name,itemCount:t.items.length,stockValueUSD:Number(a.toFixed(2))}})}let h=n.filter(e=>e.quantityInStock<5).slice(0,10);return o.Z.json({totalStockValueUSD:Number(s.toFixed(2)),totalPotentialRevenueSRD:Number(d.toFixed(2)),totalPotentialProfitSRD:Number((d-3.75*s).toFixed(2)),itemCountByStatus:l,companyMetrics:m,userMetrics:p,lowStockItems:h.map(e=>({id:e.id,name:e.name,quantityInStock:e.quantityInStock,status:e.status,company:e.company,assignedUser:e.assignedUser,location:e.location})),totalItems:n.length})}catch(e){return console.error("Error fetching dashboard metrics:",e),o.Z.json({error:"Internal server error"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/dashboard-metrics/route",pathname:"/api/dashboard-metrics",filename:"route",bundlePath:"app/api/dashboard-metrics/route"},resolvedPagePath:"D:\\ManisCore_Dashboard\\src\\app\\api\\dashboard-metrics\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:S,staticGenerationBailout:y}=l,g="/api/dashboard-metrics/route";function U(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},8828:(e,t,a)=>{a.d(t,{_:()=>n});let r=require("@prisma/client"),i=globalThis,n=i.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[147,204],()=>a(9142));module.exports=r})();