"use strict";(()=>{var e={};e.id=802,e.ids=[802],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7767:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>S,originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>I});var n={};a.r(n),a.d(n,{GET:()=>d,POST:()=>l});var i=a(1874),r=a(9195),s=a(8276),o=a(306),m=a(8828),c=a(4552);async function d(e){try{let{searchParams:t}=new URL(e.url),a=Object.fromEntries(t.entries()),n=c.mQ.safeParse(a);if(!n.success)return o.Z.json({error:"Invalid query parameters",details:n.error.issues},{status:400});let{page:i,limit:r,sortBy:s,order:d,status:l,searchQuery:u,companyId:p,assignedUserId:h,locationId:y}=n.data,S={};l&&(S.status=l),u&&(S.name={contains:u,mode:"insensitive"}),p&&(S.companyId=p),h&&(S.assignedUserId=h),y&&(S.locationId=y);let I=(i-1)*r,[g,_]=await Promise.all([m._.item.findMany({where:S,include:{company:{select:{id:!0,name:!0}},assignedUser:{select:{id:!0,name:!0,email:!0}},location:{select:{id:!0,name:!0}}},orderBy:{[s]:d},skip:I,take:r}),m._.item.count({where:S})]),f=g.map(e=>{let t=e.quantityInStock>0?e.freightCostUSD/e.quantityInStock:0,a=e.costPerUnitUSD+t,n=e.sellingPriceSRD-3.75*a,i=n*e.quantityInStock;return{...e,totalCostPerUnitUSD:Number(a.toFixed(2)),profitPerUnitSRD:Number(n.toFixed(2)),totalProfitSRD:Number(i.toFixed(2))}}),R=Math.ceil(_/r);return o.Z.json({items:f,pagination:{page:i,limit:r,totalCount:_,totalPages:R,hasNext:i<R,hasPrev:i>1}})}catch(e){return console.error("Error fetching items:",e),o.Z.json({error:"Internal server error"},{status:500})}}async function l(e){try{let t=await e.json(),a=c.bu.safeParse(t);if(!a.success)return o.Z.json({error:"Invalid item data",details:a.error.issues},{status:400});let n=a.data;if("Ordered"===n.status){let e=await m._.company.findUnique({where:{id:n.companyId},select:{id:!0,name:!0,cashBalanceUSD:!0}});if(!e)return o.Z.json({error:"Company not found"},{status:404});let t=n.costPerUnitUSD*n.quantityInStock+n.freightCostUSD;if(e.cashBalanceUSD<t)return o.Z.json({error:"Insufficient funds",message:`Company ${e.name} has insufficient USD balance. Required: $${t.toFixed(2)}, Available: $${e.cashBalanceUSD.toFixed(2)}`,required:t,available:e.cashBalanceUSD},{status:400});await m._.company.update({where:{id:n.companyId},data:{cashBalanceUSD:e.cashBalanceUSD-t}})}let i=await m._.item.create({data:n,include:{company:{select:{id:!0,name:!0}},assignedUser:{select:{id:!0,name:!0,email:!0}},location:{select:{id:!0,name:!0}}}});return o.Z.json(i,{status:201})}catch(e){return console.error("Error creating item:",e),o.Z.json({error:"Internal server error"},{status:500})}}let u=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/items/route",pathname:"/api/items",filename:"route",bundlePath:"app/api/items/route"},resolvedPagePath:"D:\\ManisCore_Dashboard\\src\\app\\api\\items\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:y,headerHooks:S,staticGenerationBailout:I}=u,g="/api/items/route";function _(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},8828:(e,t,a)=>{a.d(t,{_:()=>r});let n=require("@prisma/client"),i=globalThis,r=i.prisma??new n.PrismaClient},4552:(e,t,a)=>{a.d(t,{Em:()=>d,Hw:()=>u,I6:()=>h,MX:()=>y,bu:()=>m,eS:()=>p,mQ:()=>c,vw:()=>l});var n=a(8076);let i=n.KmV(["ToOrder","Ordered","Arrived","Sold"]),r=n.KmV(["ADMIN","MANAGER","STAFF"]),s=n.KmV(["DINNER","OFFICE_SUPPLIES","MARKETING","TRANSPORTATION","UTILITIES","RENT","MAINTENANCE","MISCELLANEOUS"]),o=n.KmV(["SRD","USD"]),m=n.Ryn({name:n.Z_8().min(1,"Name is required").max(100,"Name must be less than 100 characters"),status:i,quantityInStock:n.Rxh().int().min(0,"Quantity must be non-negative"),costPerUnitUSD:n.Rxh().min(0,"Cost must be non-negative"),freightCostUSD:n.Rxh().min(0,"Freight cost must be non-negative"),sellingPriceSRD:n.Rxh().min(0,"Selling price must be non-negative"),notes:n.Z_8().optional(),companyId:n.Z_8().min(1,"Company is required"),assignedUserId:n.Z_8().optional(),locationId:n.Z_8().optional()}),c=n.Ryn({page:n.oQ2.number().int().min(1).default(1),limit:n.oQ2.number().int().min(1).max(100).default(10),sortBy:n.KmV(["name","status","quantityInStock","costPerUnitUSD","sellingPriceSRD","createdAt"]).default("createdAt"),order:n.KmV(["asc","desc"]).default("desc"),status:i.optional(),searchQuery:n.Z_8().optional(),companyId:n.Z_8().optional(),assignedUserId:n.Z_8().optional(),locationId:n.Z_8().optional()}),d=n.Ryn({name:n.Z_8().min(1,"Company name is required").max(100,"Company name must be less than 100 characters")}),l=n.Ryn({cashBalanceSRD:n.Rxh().min(0,"Cash balance must be non-negative"),cashBalanceUSD:n.Rxh().min(0,"Cash balance must be non-negative"),stockValueSRD:n.Rxh().min(0,"Stock value must be non-negative"),stockValueUSD:n.Rxh().min(0,"Stock value must be non-negative")}),u=n.Ryn({name:n.Z_8().min(1,"Name is required").max(100,"Name must be less than 100 characters"),email:n.Z_8().email("Invalid email address"),role:r,isActive:n.O72(),companyId:n.Z_8().min(1,"Company is required")}),p=n.Ryn({name:n.Z_8().min(1,"Location name is required").max(100,"Location name must be less than 100 characters"),address:n.Z_8().optional(),description:n.Z_8().optional(),isActive:n.O72(),companyId:n.Z_8().min(1,"Company is required"),managerId:n.Z_8().optional()}),h=n.Ryn({description:n.Z_8().min(1,"Description is required").max(200,"Description must be less than 200 characters"),amount:n.Rxh().min(.01,"Amount must be greater than 0"),currency:o,category:s,date:n.Z_8().datetime().optional(),notes:n.Z_8().optional(),companyId:n.Z_8().min(1,"Company is required"),createdById:n.Z_8().optional()}),y=n.Ryn({page:n.oQ2.number().int().min(1).default(1),limit:n.oQ2.number().int().min(1).max(100).default(10),sortBy:n.KmV(["date","amount","category","createdAt"]).default("date"),order:n.KmV(["asc","desc"]).default("desc"),category:s.optional(),currency:o.optional(),searchQuery:n.Z_8().optional(),companyId:n.Z_8().optional(),createdById:n.Z_8().optional(),dateFrom:n.Z_8().datetime().optional(),dateTo:n.Z_8().datetime().optional()})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[147,204,76],()=>a(7767));module.exports=n})();